<!doctype html>
<html>
    <head>
		<meta charset="UTF-8">
		
 <script src="https://d3js.org/d3.v4.js"></script>
 <script src="https://d3js.org/d3-array.v1.min.js"></script>
 <script src="https://d3js.org/d3-geo.v1.min.js"></script>
 <script src="https://d3js.org/d3-scale.v2.min.js"></script>
 <script src="https://cdnjs.cloudflare.com/ajax/libs/d3-transform/1.0.4/d3-transform.js"></script>
<script src="https://d3js.org/d3-axis.v1.min.js"></script>


		<style type ="text/css">
		
		
	
		
		/* On mouse hover, coloriage des communes  */
		
.Blues .q0-9 {fill:rgb(34, 120, 15)}
.Blues .q1-9{fill:rgb(1, 215, 88)}
.Blues .q2-9{fill:rgb(176, 242, 182)}
.Blues .q3-9{fill:rgb(37, 253, 233)}

path:hover {
	
	fill-opacity: .7;
	stroke-width: 5;
}


		div.tooltip {
    position: absolute;
    text-align: center;
    color: white;
    width: 250px;
    height: 60px;
    padding: 2px;
    font: 12px sans-serif;
    background: grey;
    border: 0px;
    border-radius: 8px;
    pointer-events: none;
}

.rectangle {
	fill: steelblue;
}
.rectangle:hover {
	fill: orange;
}
.axis {
  font: 10px sans-serif;
}

.axis path,
.axis line {
  fill: none;
  stroke: #000;
  shape-rendering: crispEdges;
}
		</style>
    </head>
    <body>
	<!-- <div id="drop" align=center></div> -->
	<!-- <h1>Plateforme de visualisation</h1> -->
	<h2></h2>
       <script>
	   
	   
	 
	//methode 1	
var canvas = d3.select("body").append("svg")
	 	 .attr("width", 1000)
	 	 .attr("height", 1000)
		 .attr ("class","Blues")

var div = d3.select("body").append("div")   
		.attr("class", "tooltip")               
		.style("opacity", 0);
				

d3.json("dz1.geojson", function(data) {
var group = canvas.selectAll("g")
		 .data(data.features)
		 .enter()
		 .append("g")	
	     .attr('id', function(d) {return "d" + d.properties.CCA_1;})	

 d3.csv("DZmap.csv", function(csv) {
var quantile = d3.scaleQuantile()
        .domain([0, d3.max(csv, function(e) { return +e.MASCULIN; })])
        .range(d3.range(5));
var elements = Object.keys(csv[0]);
	
var legend = canvas.append('g')
		.attr('transform', 'translate(800, 250)')
		.attr('id', 'legend');
				
				
		legend.selectAll('.colorbar')
        .data(d3.range(5))
       .enter().append('svg:rect')
        .attr('y', function(d) { return d * 20 + 'px'; })
        .attr('height', '20px')
        .attr('width', '20px')
        .attr('x', '0px')
        .attr("class", function(d) { return "q" + d + "-9"; });
    	
var legendScale = d3.scaleLinear()
		.domain([0, d3.max(csv, function(e) { return +e.MASCULIN; })])
		.range([0, 5 * 20]);
	
var legendAxis = canvas.append("g")
		.attr('transform', 'translate(828, 250)')
		.call(d3.axisRight(legendScale).ticks(5));
		
	csv.forEach(function(e,i) {
    d3.select("#d" + e.CCA_1	)
        .attr("class", function(d) { return "department q" + quantile(+e.MASCULIN) + "-9"; })
        .on("mouseover", function(d) {
		//d3.select(this).remove();
		d3.select("h2").text(e.Wilaya);
		d3.select(this).style("cursor", "pointer");
            div.transition()        
                .duration(200)      
                .style("opacity", .9);
            div.html("<b>Région : </b>Algérie<br>"
                   + "<b>Département : </b>" +e.Wilaya + "<br>"
                   + "<b>Population : </b>" + e.TOTAL + "<br>")
				  
                .style("left", (d3.event.pageX + 30) + "px")     
                .style("top", (d3.event.pageY - 30) + "px");
        })
        .on("mouseout", function(d) {
            div.transition()
                .duration(500)
                .style("opacity", 0);
            div.html("")
                .style("left", "0px")
                .style("top", "0px");
        });
		
		<!-- d3.select(this).on("click",fmpurl); -->

  <!-- function fmpurl() { -->
		<!-- var url = "file:///C:/xampp/htdocs/tut%20-%20Copie/histograme.html" ; -->
		<!-- window.location = url; -->
<!-- } -->
});


});	
					   
///////////////////////////////////////////////////////////////

var projection=d3.geoTransverseMercator()
		.center ([3.7973, 36.9801])
		.scale(2000)
		.translate([500,100]);
					

var path=d3.geoPath().projection(projection);
var areas = group.append("path")
		.attr("d",path)
		.attr ("class","area")
		.attr ("stroke","white")
		.attr ("stroke-width",.1)
		<!-- .attr("fill","orange"); -->
		d3.select("#data").on("change", function() {
    selectedData = this.value;
         
    quantile = d3.scale.scaleQuantile
        .domain([0, d3.max(csv, function(e) { return +e[selectedData]; })])
        .range(d3.range(5));
         
    legendScale.domain([0, d3.max(csv, function(e) { return +e[selectedData]; })]);
    legendAxis.call(d3.axisRight(legendScale).ticks(5));
         
    csv.forEach(function(e,i) {
        d3.select("#d" + e.CODE_DEPT)
            .attr("class", function(d) { return "department q" + quantile(+e[selectedData]) + "-9"; });
    });
});
		

				});

	</script>
    </body>
</html>